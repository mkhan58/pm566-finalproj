---
title: "PM566 Final Project"
author: "Misha Khan"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

This is my PM566 Final Project website.

<br>

# Lab setup

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}
library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)

# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px")

```

```{r, echo = FALSE}
source("pm566-midterm-final-copy.R")

#Viz 1: Months with the Highest Crime in the Top 5 Areas
month_crime = plot_ly(ncrimesdate, x = ~Month, y = ~n, color = ~Area, type = "bar")
month_crime <- month_crime %>% layout(yaxis = list(title = 'Count'), barmode = 'stack')
month_crime <- month_crime %>% layout(title = "Months with the Highest Crime in the Top 5 Areas")
month_crime_plotly <- ggplotly(month_crime)
month_crime_plotly 



#Viz 2: Victim Age and Sex
#Interactive Histogram
vict_demo <-plot_ly(victim_demographics, x = ~victim_age_f, color = ~`Victim Sex`) %>%
  add_histogram()
#vict_demo <- vict_demo %>% layout(barmode = "overlay")
vict_demo <- vict_demo %>% layout(title = "Histogram of Victim's Age and Gender",
                                  yaxis = list(
                                    title = "Count"
                                  ),
                                  xaxis = list(
                                    title = "Age"
                                  ))
vict_demo_plotly <- ggplotly(vict_demo)
vict_demo_plotly
```

```{r}
### LEAFLET MAP PLOT OF CENTRAL 
central_top_crimes <-
  crimedat %>%
  select(`Record No`, `Crime Code`, Area, Crime, `Year`, `Lat`, `Lon`)

#Subset Area = Central and Year = 2021
central_top_crimes <- subset(central_top_crimes, 
                             `Area` %in% c("Central") &
                               `Year` %in% c("2021"))

#View top 5 crimes in Central
central_top_crimes %>% 
  group_by(Area, `Crime Code`, Crime) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count)) %>%
  head(,10) %>%
  knitr::kable()

#Now subset Crime Code to top 5 in that area
central_top_crimes <- subset(central_top_crimes, 
                             `Crime Code` %in% c("330", "624", "740", "230", "440"))

#Map color palette
central.pal <- colorFactor(c('red', 'yellow', 'blue', 'green', 'purple'), domain = central_top_crimes$`Crime`)

central_map <- 
  leaflet(central_top_crimes) %>%  
  addProviderTiles('CartoDB.Positron') %>% 
  addCircles(
    lat = ~Lat, 
    lng = ~Lon,
    label = ~paste0(central_top_crimes$`Crime`),
    color = ~ central.pal(central_top_crimes$`Crime`),
    opacity = 0.5,
    fillOpacity = 1,
    radius = 5
  ) %>%
  addLegend('bottomleft', 
            pal = central.pal,  
            values = central_top_crimes$`Crime`,
            title = 'Central Crime Map', 
            opacity = 1)
central_map
```


## Showcasing plots {.tabset}

### Tab 1

```{r echo=FALSE}
central_map
```  

### Tab 2

```{r echo=FALSE}
month_crime_plotly  
```

### Tab 3
```{r echo=FALSE}
vict_demo_plotly
```
## {-}
